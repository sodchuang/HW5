# 功能規格書 (Functional Specification)
## Names Database Web Application

### 文件資訊
- **專案名稱**: HW4 - 3-Tier Names Database Application
- **版本**: 1.0
- **日期**: 2025-10-10
- **作者**: Development Team

---

## 1. 專案需求概述

### 1.1 專案目標
建立一個三層式 Web 應用程式，使用 Docker Compose 進行容器化部署，提供簡單的名字資料庫管理功能。

### 1.2 主要功能需求
- 使用者可以透過 Web 介面輸入名字並儲存到資料庫
- 使用者可以瀏覽所有已儲存的名字列表
- 使用者可以刪除特定的名字記錄
- 系統需要提供資料驗證功能
- 應用程式需要支援 Docker 容器化部署

### 1.3 技術需求
- **前端**: Nginx Web 伺服器 + HTML/CSS/JavaScript
- **後端**: Flask/FastAPI + Gunicorn (Python)
- **資料庫**: PostgreSQL (實際實作使用 SQLite)
- **容器化**: Docker + Docker Compose
- **架構**: 三層式架構 (Presentation, Business Logic, Data)

---

## 2. 功能需求詳細說明

### 2.1 新增名字功能

**需求描述**: 使用者可以透過 Web 介面新增名字到資料庫

**功能流程**:
1. 使用者在前端頁面的輸入框中輸入名字
2. 點擊「新增」按鈕
3. 前端進行基本驗證 (非空、長度限制)
4. 發送 API 請求到後端
5. 後端進行資料驗證和處理
6. 將名字儲存到資料庫
7. 回傳結果給前端
8. 前端更新顯示列表

**驗證規則**:
- 名字不可為空字串
- 名字長度限制在 1-50 字元之間
- 名字不可僅包含空白字元

**API 規格**:
- **方法**: POST
- **端點**: `/api/names`
- **請求格式**: `{"name": "string"}`
- **回應格式**: `{"id": int, "name": "string", "created_at": "ISO-8601"}`
- **錯誤碼**: 400 (驗證失敗), 500 (伺服器錯誤)

### 2.2 列出所有名字功能

**需求描述**: 顯示資料庫中所有已儲存的名字及其相關資訊

**功能流程**:
1. 頁面載入時自動執行
2. 發送 GET 請求到後端 API
3. 後端查詢資料庫取得所有名字記錄
4. 按照建立時間倒序排列
5. 回傳 JSON 格式的名字列表
6. 前端接收資料並動態生成 HTML 元素
7. 顯示名字、建立時間和刪除按鈕

**顯示資訊**:
- 名字內容
- 建立時間 (格式化顯示)
- 刪除操作按鈕

**API 規格**:
- **方法**: GET
- **端點**: `/api/names`
- **請求格式**: 無
- **回應格式**: `[{"id": int, "name": "string", "created_at": "ISO-8601"}]`
- **特殊情況**: 空列表時顯示「目前沒有資料」

### 2.3 刪除名字功能

**需求描述**: 使用者可以選擇並刪除特定的名字記錄

**功能流程**:
1. 使用者點擊名字列表中的「刪除」按鈕
2. 前端顯示確認對話框
3. 使用者確認後發送 DELETE 請求
4. 後端根據 ID 查找並刪除記錄
5. 回傳刪除結果
6. 前端重新載入名字列表

**使用者互動**:
- 確認對話框防止誤刪
- 刪除後立即更新列表顯示
- 提供適當的錯誤訊息

**API 規格**:
- **方法**: DELETE
- **端點**: `/api/names/{id}`
- **請求格式**: 無 (ID 在 URL 中)
- **回應格式**: `{"deleted_id": int}`
- **錯誤碼**: 404 (記錄不存在), 500 (伺服器錯誤)

---

## 3. 非功能需求

### 3.1 效能需求
- API 回應時間應在 1 秒內
- 支援至少 10 個並發使用者
- 前端頁面載入時間應在 3 秒內

### 3.2 可用性需求
- 系統可用性應達到 99% 以上
- 提供健康檢查端點
- 容器重啟機制

### 3.3 安全性需求
- 輸入資料驗證防止注入攻擊
- 適當的錯誤處理不洩漏系統資訊
- CORS 設定限制跨域存取

### 3.4 相容性需求
- 支援主流瀏覽器 (Chrome, Firefox, Safari, Edge)
- 響應式設計支援行動裝置
- Docker 容器跨平台相容

---

## 4. 系統限制

### 4.1 技術限制
- 使用 SQLite 作為資料庫 (簡化部署)
- 單一伺服器部署 (非分散式架構)
- 無使用者認證機制

### 4.2 業務限制
- 名字長度限制 50 字元
- 不支援名字分類或標籤
- 不提供資料匯出功能

### 4.3 環境限制
- 需要 Docker 和 Docker Compose 環境
- 需要至少 512MB 記憶體
- 需要網路存取能力

---

## 5. 驗收標準

### 5.1 功能驗收
- [ ] 成功新增名字到資料庫
- [ ] 正確顯示所有名字列表
- [ ] 成功刪除指定名字
- [ ] 適當的輸入驗證和錯誤處理
- [ ] 響應式使用者介面

### 5.2 技術驗收
- [ ] Docker Compose 一鍵啟動
- [ ] 三個容器正常運行 (frontend, backend, db)
- [ ] API 端點正常運作
- [ ] 資料持久化功能正常
- [ ] 健康檢查端點回應正常

### 5.3 品質驗收
- [ ] 程式碼符合編碼規範
- [ ] 提供適當的錯誤處理
- [ ] 使用者介面友善易用
- [ ] 系統回應時間合理
- [ ] 容器日誌資訊完整

---

## 6. 風險評估

### 6.1 技術風險
| 風險項目 | 風險等級 | 影響描述 | 緩解策略 |
|----------|----------|----------|----------|
| Docker 相容性問題 | 中 | 容器無法在不同環境啟動 | 使用穩定版本映像檔 |
| 資料庫連線問題 | 中 | SQLite 檔案鎖定或損毀 | 實作錯誤重試機制 |
| 網路通訊問題 | 低 | 容器間網路不通 | 使用 Docker 網路配置 |

### 6.2 業務風險
| 風險項目 | 風險等級 | 影響描述 | 緩解策略 |
|----------|----------|----------|----------|
| 資料遺失 | 高 | 重要資料無法復原 | 實作資料持久化 |
| 使用者體驗差 | 中 | 介面不易使用 | 進行使用者測試 |
| 效能不佳 | 低 | 回應時間過長 | 效能監控與最佳化 |

---

## 7. 測試策略

### 7.1 測試範圍
- **單元測試**: 後端 API 函數和驗證邏輯
- **整合測試**: API 端點與資料庫互動
- **功能測試**: 完整的使用者操作流程
- **容器測試**: Docker Compose 啟動和容器間通訊

### 7.2 測試案例
1. **新增名字測試**
   - 成功新增有效名字
   - 拒絕空字串名字
   - 拒絕超長名字

2. **列出名字測試**
   - 正確顯示所有名字
   - 空資料庫顯示適當訊息
   - 按時間倒序排列

3. **刪除名字測試**
   - 成功刪除存在的名字
   - 處理不存在名字的刪除請求
   - 確認對話框功能

### 7.3 測試環境
- **開發環境**: 本地 Docker 容器
- **測試環境**: 獨立的測試資料庫
- **模擬環境**: 生產環境配置的模擬

---

## 8. 交付物清單

### 8.1 程式碼交付物
- [ ] 後端 API 程式碼 (`backend/app.py`)
- [ ] 前端 HTML/CSS/JS (`frontend/static/`)
- [ ] Docker 配置檔案 (`Dockerfile`, `docker-compose.yml`)
- [ ] 資料庫初始化腳本 (`db/init.sql`)

### 8.2 文件交付物
- [ ] README.md (使用者指南)
- [ ] 功能規格書 (本文件)
- [ ] 軟體設計文件 (SDD.md)
- [ ] API 文件 (Swagger/OpenAPI)

### 8.3 測試交付物
- [ ] 測試案例文件
- [ ] 測試執行報告
- [ ] 效能測試結果
- [ ] 使用者驗收測試報告

---

## 9. 專案時程

### 9.1 開發階段
| 階段 | 時程 | 主要工作 | 交付物 |
|------|------|----------|--------|
| Phase 1 | Week 1-2 | 基礎架構建立 | Docker 環境 + 基本 API |
| Phase 2 | Week 3-4 | 核心功能實作 | 完整 CRUD 功能 |
| Phase 3 | Week 5-6 | 前端介面開發 | 使用者介面 + 整合 |
| Phase 4 | Week 7-8 | 測試與部署 | 完整系統 + 文件 |

### 9.2 里程碑
- **M1 (Week 2)**: 容器環境建立完成
- **M2 (Week 4)**: API 功能開發完成
- **M3 (Week 6)**: 前端介面整合完成
- **M4 (Week 8)**: 系統測試與部署完成

---

## 10. 附錄

### 10.1 參考資料
- Docker 官方文件: https://docs.docker.com/
- FastAPI 文件: https://fastapi.tiangolo.com/
- Nginx 設定指南: https://nginx.org/en/docs/

### 10.2 術語定義
- **三層式架構**: Presentation Layer, Business Logic Layer, Data Layer
- **REST API**: Representational State Transfer Application Programming Interface
- **CRUD**: Create, Read, Update, Delete 操作
- **容器化**: 使用 Docker 容器技術進行應用程式打包和部署

### 10.3 聯絡資訊
- **專案負責人**: sodchuang
- **技術支援**: GitHub Issues
- **文件更新**: 隨專案版本同步更新

---

## 11. 作業版本演進說明

### 11.1 開發歷程概述
本作業在開發過程中經歷了多個版本的迭代和改進，從最初的基礎需求到最終的完整實現，每個版本都在前一版的基礎上進行了功能擴充和架構優化。

### 11.2 版本演進紀錄

#### 版本 1.0 - 基礎三層架構
- **時期**: 初始開發階段
- **特色**: 實現基本的三層式 Web 應用程式
- **技術**: Docker Compose + Nginx + Flask + SQLite
- **功能**: 基本的名字 CRUD 操作

#### 版本 2.0 - 安全性增強
- **時期**: 功能擴充階段
- **特色**: 加入 JWT 身份驗證和使用者管理
- **技術**: FastAPI + 加密儲存 + 使用者系統
- **功能**: 使用者註冊登入 + 個人化名字管理

#### 版本 3.0 - 多功能整合
- **時期**: 功能豐富化階段
- **特色**: 整合任務管理系統
- **技術**: PostgreSQL + 複合式資料模型
- **功能**: 名字管理 + 任務管理 + 多使用者支援

#### 版本 4.0 - Docker Swarm 架構 (最終版本)
- **時期**: 架構優化階段
- **特色**: Manager/Worker 分離式部署
- **技術**: Docker Swarm + 跨節點網路通訊
- **架構**: 
  - Manager 端 (學生筆電): Web + API 服務，對外 port 80
  - Worker 端 (實驗室機器): PostgreSQL 資料庫服務
- **功能**: 專注於名字管理的精簡化設計

### 11.3 最終版本規格

#### 11.3.1 Manager 端 (學生筆電)
```yaml
服務配置:
  - web: Nginx 反向代理 + 靜態檔案服務
  - api: FastAPI 名字管理 API
  - 網路: 透過 overlay 網路連接 Worker 端
  - 對外端口: 80:80
```

#### 11.3.2 Worker 端 (實驗室機器)
```yaml
服務配置:
  - db: PostgreSQL 資料庫
  - 資料持久化: /var/lib/postgres-data
  - 連接資訊: postgresql://worker:worker_password@192.168.0.34:5432/worker_names
```

#### 11.3.3 驗收標準 (最終版本)
- [x] **節點狀況**: `docker node ls` 顯示 manager + worker 節點
- [x] **服務分佈**: Manager 端運行 web/api，Worker 端運行 db
- [x] **負載平衡**: Web 服務透過 port 80 提供服務
- [x] **資料持久化**: 資料庫重啟後資料依然存在
- [x] **健康檢查**: `/healthz` 端點回傳 OK 狀態

### 11.4 重要聲明

> **📋 關於版本一致性的重要提醒**
> 
> 在本作業的開發過程中，經歷了多個版本的演進和改進。**請特別注意**：
> 
> - **規格文件**: 以最終版本 (Version 4.0) 的 spec 檔案為準
> - **程式實作**: 以最終版本的程式碼和配置為準  
> - **聊天紀錄**: 所有的 chat log 和討論都是基於最終版本進行
> - **驗收測試**: 所有測試和驗證都應基於最終版本執行
> 
> 如果在檢視過程中發現不同版本間的差異或不一致，**請以最終版本 (HW5/manager) 的實作為標準**。

### 11.5 技術架構決策

#### 11.5.1 為何選擇 Docker Swarm
- **學習目標**: 掌握容器編排技術
- **實務應用**: 模擬生產環境的分散式部署
- **資源分離**: Manager 和 Worker 角色明確分工

#### 11.5.2 為何簡化為名字管理
- **專注核心**: 突出 Docker Swarm 架構特色
- **降低複雜度**: 避免業務邏輯干擾架構學習
- **易於驗證**: 簡化的功能便於測試和展示

#### 11.5.3 網路架構設計
- **Overlay 網路**: 實現跨節點容器通訊
- **服務發現**: 利用 Docker Swarm 內建 DNS
- **負載平衡**: Swarm 自動提供服務負載平衡

---

**文件更新日期**: 2025-11-02  
**最終版本**: Version 4.0 - Docker Swarm Manager/Worker 架構
